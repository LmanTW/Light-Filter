(function(){"use strict";const d={none:{name:"None",pixel:t=>t.color,options:{}},colorAdjustment:{name:"Color Adjustment",pixel:(t,e)=>({r:g(t.color.r+e.red,0,255),g:g(t.color.g+e.green,0,255),b:g(t.color.b+e.blue,0,255)}),options:{red:{name:"Red",default:0,min:-255,max:255,step:1},green:{name:"Green",default:0,min:-255,max:255,step:1},blue:{name:"Blue",default:0,min:-255,max:255,step:1}}},colorPosterization:{name:"Color Posterization",pixel:(t,e)=>{const r=-10+e.strength*10;return{r:i(t.color.r,r),g:i(t.color.g,r),b:i(t.color.b,r)}},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1}}},blur:{name:"Blur",pixel:(t,e)=>{const r=[],n=[],s=[],a=Math.round((t.size.width+t.size.height)/75*e.strength);for(let o=t.position.x-a;o<t.position.x+a;o++)for(let h=t.position.y-a;h<t.position.y+a;h++){const c=t.getColor(o,h);c!==void 0&&(r.push(c.r),n.push(c.g),s.push(c.b))}return{r:r.length>0?r.reduce((o,h)=>o+h)/r.length:t.color.r,g:n.length>0?n.reduce((o,h)=>o+h)/n.length:t.color.g,b:s.length>0?s.reduce((o,h)=>o+h)/s.length:t.color.b}},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1}}},brightness:{name:"Brightness",pixel:(t,e)=>({r:g(t.color.r+255*e.brightness,0,255),g:g(t.color.g+255*e.brightness,0,255),b:g(t.color.b+255*e.brightness,0,255)}),options:{brightness:{name:"Brightness",default:0,min:-1,max:1,step:.1}}},ghost:{name:"Ghost",pixel:(t,e)=>{const r=(t.size.width+t.size.height)/5,n=t.getColor(Math.round(t.position.x-e.xOffset*r),Math.round(t.position.y-e.yOffset*r));return n===void 0?{r:t.color.r,g:t.color.g,b:t.color.b}:{r:t.color.r+(n.r-t.color.r)*e.strength,g:t.color.g+(n.g-t.color.g)*e.strength,b:t.color.b+(n.b-t.color.b)*e.strength}},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1},xOffset:{name:"X Offset",default:0,min:-1,max:1,step:.1},yOffset:{name:"X Offset",default:0,min:-1,max:1,step:.1}}},grayscale:{name:"Grayscale",pixel:(t,e)=>{const r=(t.color.r+t.color.g+t.color.b)/3;return{r:t.color.r+(r-t.color.r)*e.strength,g:t.color.g+(r-t.color.g)*e.strength,b:t.color.b+(r-t.color.b)*e.strength}},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1}}},invert:{name:"Invert",pixel:(t,e)=>({r:t.color.r+(255-t.color.r-t.color.r)*e.strength,g:t.color.g+(255-t.color.g-t.color.g)*e.strength,b:t.color.b+(255-t.color.b-t.color.b)*e.strength}),options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1}}},noise:{name:"Noise",pixel:(t,e)=>{if(Math.random()<=e.amount){const r=(Math.random()-.5)*2*(255*e.strength);return{r:g(t.color.r+r,0,255),g:g(t.color.g+r,0,255),b:g(t.color.b+r,0,255)}}return t.color},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1},amount:{name:"Amount",default:.5,min:0,max:1,step:.1}}},wave:{name:"Wave",pixel:(t,e)=>{const r=6.28/(t.size.width*e.size)*t.position.x,n=Math.sin(r)*(t.size.height*e.strength);let s=t.position.x+n*Math.cos(e.angle*Math.PI/180),a=t.position.y+n*Math.sin(e.angle*Math.PI/180);for(;a<0;)a+=t.size.height;for(;a>t.size.height;)a-=t.size.height;for(;s<0;)s+=t.size.width;for(;s>t.size.width;)s-=t.size.width;const o=t.getColor(Math.round(s),Math.round(a));return o===void 0?{r:t.color.r,g:t.color.g,b:t.color.b}:{r:o.r,g:o.g,b:o.b}},options:{strength:{name:"Strength",default:0,min:0,max:1,step:.1},size:{name:"Size",default:.5,min:0,max:1,step:.1},angle:{name:"Angle",default:90,min:0,max:360,step:1}}}};function i(t,e){const r=255/(e-1);return Math.round(t/r)*r}function g(t,e,r){return t<e?e:t>r?r:t}self.addEventListener("message",t=>{const e=t.data;if(e.type,e.type==="render"){self.postMessage({type:"setState",stateType:e.preview?"renderingPreview":"rendering",state:"Rendering Preview",progress:"0%",resolution:`${e.width} x ${e.height}`});const r={color:{r:0,g:0,b:0},size:{width:e.width,height:e.height},position:{x:0,y:0},getColor:(s,a)=>{const o=(s+a*e.width)*4;return e.data[o]===void 0?void 0:{r:e.data[o],g:e.data[o+1],b:e.data[o+2]}}},n=new Uint8Array(e.width*e.height*4);n.set(e.data,0),e.lenses.forEach((s,a)=>{if(s.enabled){for(let o=0;o<e.data.length;o+=4)o%e.width===0&&self.postMessage({type:"setState",progress:`${Math.round(100/(e.data.length*e.lenses.length)*(e.width*e.height*4*a+o))}%`}),r.color={r:e.data[o],g:e.data[o+1],b:e.data[o+2]},r.position={x:Math.trunc(o/4%e.width),y:Math.trunc(o/4/e.width)},r.color=d[s.type].pixel(r,s.options),n[o]=r.color.r,n[o+1]=r.color.g,n[o+2]=r.color.b,n[o+3]=255;e.data.set(n,0)}}),self.postMessage({type:"setState",stateType:"idle",state:"Idle",progress:null}),self.postMessage({type:"renderResult",preview:e.preview,width:e.width,height:e.height,data:n})}})})();
